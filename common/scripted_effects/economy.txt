

#### replaced by dynamic modifier donations
#civil_factory_output = {
#	if = {
#		limit = {
#			check_variable = {
#				civil_capacity < ic
#			}
#		}
#		ROOT = {
#			add_offsite_building = {
#				type = industrial_complex
#				level = 1
#			}
#		}
#		add_to_variable = {
#			civil_capacity = 1
#		}
#		civil_factory_output = yes
#	}
#	if = {
#		limit = {
#			check_variable = {
#				civil_capacity > ic
#			}
#		}
#		ROOT = {
#			add_offsite_building = {
#				type = industrial_complex
#				level = -1
#			}
#		}
#		add_to_variable = {
#			civil_capacity = -1
#		}
#		civil_factory_output = yes
#	}
#}
#
#extra_factory_output = {
#	if = {
#		limit = {
#			check_variable = {
#				extra_mils < factory_duplicator
#			}
#		}
#		ROOT = {
#			add_offsite_building = {
#				type = arms_factory
#				level = 1
#			}
#		}
#		add_to_variable = {
#			extra_mils = 1
#		}
#		extra_factory_output = yes
#	}
#	if = {
#		limit = {
#			check_variable = {
#				extra_mils > factory_duplicator
#			}
#		}
#		ROOT = {
#			add_offsite_building = {
#				type = arms_factory
#				level = -1
#			}
#		}
#		add_to_variable = {
#			extra_mils = -1
#		}
#		extra_factory_output = yes
#	}
#}
#
#extra_dockyard_output = {
#	if = {
#		limit = {
#			check_variable = {
#				extra_docks < dockyard_duplicator
#			}
#		}
#		ROOT = {
#			add_offsite_building = {
#				type = harbour
#				level = 1
#			}
#		}
#		add_to_variable = {
#			extra_docks = 1
#		}
#		extra_dockyard_output = yes
#	}
#	if = {
#		limit = {
#			check_variable = {
#				extra_docks > dockyard_duplicator
#			}
#		}
#		ROOT = {
#			add_offsite_building = {
#				type = harbour
#				level = -1
#			}
#		}
#		add_to_variable = {
#			extra_docks = -1
#		}
#		extra_dockyard_output = yes
#	}
#}



migrant_per_state_recalc = {
	add_to_variable = { THIS.migrant_check_state = 1 }
	if = {
		limit = {
			check_variable = { THIS.migrant_check_state > states^num }
		}
		set_variable = { THIS.migrant_check_state = 1 }
	}

	var:migrant_check_state = {

		if = {
			limit = {
				is_valid_migration_target = yes
			}
			if = {
				limit = {
					NOT = {
						is_in_array = { PREV.available_migrant_states_array = THIS.id }
					}
				}
				add_to_array = {
					array = PREV.available_migrant_states_array
					value = THIS.id
				}
			}
		}
		else_if = {
			limit = {
				is_in_array = { PREV.available_migrant_states_array = THIS.id }
			}
			remove_from_array = { PREV.available_migrant_states_array = THIS.id }
		}
	}
}


decrease_civ_buy_effect = {
	add_to_variable = { civ_buy_factor = -0.01 }
	recalc_civ_buy_clamp = yes
}
increase_civ_buy_effect = {
	add_to_variable = { civ_buy_factor = 0.01 }
	recalc_civ_buy_clamp = yes
}
recalc_civ_buy_clamp = {
	set_variable = { treasury_min = modifier@min_civil_percentage }
	set_variable = { treasury_max = 1 }
	subtract_from_variable = { treasury_max = modifier@min_treasury_percentage }
	clamp_variable = { var = treasury_min  min = 0 }
	clamp_variable = { var = treasury_max  min = 0 }
	if = {
		limit = {
			check_variable = { treasury_min > treasury_max }
		}
		set_variable = { treasury_difference = modifier@min_deposit_percentage }
		add_to_variable = { treasury_difference = modifier@min_factory_percentage }
		add_to_variable = { treasury_difference = -1 }
		divide_variable = { treasury_difference = 2 }
		
		subtract_from_variable = { deposit_min = treasury_difference }
		subtract_from_variable = { deposit_max = treasury_difference }
	}

	clamp_variable = { var = civ_buy_factor  min = treasury_min max = treasury_max }
	set_variable = { treasury_factor = 1 }
	subtract_from_variable = { treasury_factor = civ_buy_factor }
}

decrease_factory_effect = {
	add_to_variable = { deposit_percentage = 0.01 }
	recalc_increase_factory_clamp = yes
}
increase_factory_effect = {
	add_to_variable = { deposit_percentage = -0.01 }
	recalc_increase_factory_clamp = yes
}
recalc_increase_factory_clamp = {
	set_variable = { deposit_min = modifier@min_deposit_percentage }
	set_variable = { deposit_max = 1 }
	subtract_from_variable = { deposit_max = modifier@min_factory_percentage }
	clamp_variable = { var = deposit_min  min = 0 }
	clamp_variable = { var = deposit_max  min = 0 }
	if = {
		limit = {
			check_variable = { deposit_min > deposit_max }
		}
		set_variable = { deposit_difference = modifier@min_deposit_percentage }
		add_to_variable = { deposit_difference = modifier@min_factory_percentage }
		add_to_variable = { deposit_difference = -1 }
		divide_variable = { deposit_difference = 2 }
		
		subtract_from_variable = { deposit_min = deposit_difference }
		subtract_from_variable = { deposit_max = deposit_difference }
	}

	clamp_variable = { var = deposit_percentage  min = deposit_min max = deposit_max }
	set_variable = { factory_percentage = 1 }
	subtract_from_variable = { factory_percentage = deposit_percentage }
}


@deposit_construction_cost = 15

####### state construction not instant

add_farm_here = {

	FROM = {
		add_building_construction = {
			type = farm
			level = 1
			instant_build = no
		}
	}

}

add_fishing_stand_here = {
	FROM = {
		add_building_construction = {
			type = fishing_stand
			level = 1
			instant_build = no
		}
	}
}

add_ranch_here = {
	
	FROM = {
		add_building_construction = {
			type = ranch
			level = 1
			instant_build = no
		}
	}
}

add_lumber_mill_here = {
	
	FROM = {
		add_building_construction = {
			type = lumber_mill
			level = 1
			instant_build = no
		}
	}
}

add_quarry_here = {
	
	FROM = {
		add_building_construction = {
			type = quarry
			level = 1
			instant_build = no
		}
	}
}

add_mine_here = {
	
	FROM = {
		add_building_construction = {
			type = mine
			level = 1
			instant_build = no
		}
	}
}

###    ###  #   # ###    ###   #   #     
#  #  #   # ##  # #  #  #   #  ## ##      
###   ##### # # # #  #  #   #  # # #     
#  #  #   # #  ## #  #  #   #  #   #   
#   # #   # #   # ###    ###   #   #     


simulated_construction = {
	if = {
		limit = {
			not = {
				has_dynamic_modifier = { modifier = deposit_construction_cost }
			}
		}
		add_dynamic_modifier = { modifier = deposit_construction_cost }
	}
}

add_farm_random = {
	
	random_controlled_state = {
		limit = {
			AND = {
				ROOT = { NOT = { has_country_flag = core_all_construction_flag } }
				is_core_of = ROOT
			}
			set_temp_variable = { farms = building_level@farm }
			add_to_temp_variable = { farms = farm_construction_que }
			check_variable = {
				field > farms
			}
			check_variable = {
				var = ROOT:modifier@farm_level_max
				value = farms
				compare = greater_than
			}
		}

		add_farm_here = yes
	}

}

add_fishing_stand_random = {

	random_controlled_state = {
		limit = {
			AND = {
				ROOT = { NOT = { has_country_flag = core_all_construction_flag } }
				is_core_of = ROOT
			}
			set_temp_variable = { fishing_stands = building_level@fishing_stand }
			add_to_temp_variable = { fishing_stands = fishing_stand_construction_que }
			check_variable = {
				water > fishing_stands
			}
			check_variable = {
				var = ROOT:modifier@fishing_stand_level_max
				value = fishing_stands
				compare = greater_than
			}
		}

		add_fishing_stand_here = yes
	}

}

add_ranch_random = {

	random_controlled_state = {
		limit = {
			AND = {
				ROOT = { NOT = { has_country_flag = core_all_construction_flag } }
				is_core_of = ROOT
			}
			set_temp_variable = { ranches = building_level@ranch }
			add_to_temp_variable = { ranches = ranch_construction_que }
			check_variable = {
				animal > ranches
			}
			check_variable = {
				var = ROOT:modifier@ranch_level_max
				value = ranches
				compare = greater_than
			}
		}

		add_ranch_here = yes
	}
}

add_lumber_mill_random = {

	random_controlled_state = {
		limit = {
			AND = {
				ROOT = { NOT = { has_country_flag = core_all_construction_flag } }
				is_core_of = ROOT
			}
			set_temp_variable = { lumber_mills = building_level@lumber_mill }
			add_to_temp_variable = { lumber_mills = lumber_mill_construction_que }
			check_variable = {
				forest > lumber_mills
			}
			check_variable = {
				var = ROOT:modifier@lumber_mill_level_max
				value = lumber_mills
				compare = greater_than
			}
		}

		add_lumber_mill_here = yes
	}
}

add_quarry_random = {

	random_controlled_state = {
		limit = {
			AND = {
				ROOT = { NOT = { has_country_flag = core_all_construction_flag } }
				is_core_of = ROOT
			}
			set_temp_variable = { quarries = building_level@quarry }
			add_to_temp_variable = { quarries = quarry_construction_que }
			check_variable = {
				stonefield > quarries
			}
			check_variable = {
				var = ROOT:modifier@quarry_level_max
				value = quarries
				compare = greater_than
			}
		}

		add_quarry_here = yes
	}
}

add_mine_random = {

	random_controlled_state = {
		limit = {
			AND = {
				ROOT = { NOT = { has_country_flag = core_all_construction_flag } }
				is_core_of = ROOT
			}
			set_temp_variable = { mines = building_level@mine }
			add_to_temp_variable = { mines = mine_construction_que }
			check_variable = {
				mountain > mines
			}
			check_variable = {
				var = ROOT:modifier@mine_level_max
				value = mines
				compare = greater_than
			}
		}

		add_mine_here = yes
	}
}

add_mill_random = {
	if = {
		limit = {
			has_country_flag = core_all_construction_flag
		}
		random_owned_controlled_state = {
			limit = {
				free_building_slots = {
					building = mill
					size > 0
					include_locked = no
				}
			}
			add_building_construction = {
				type = mill
				level = 1
				instant_build = no
			}
		}
	}
	else = {
		random_owned_controlled_state = {
			limit = {
				free_building_slots = {
					building = mill
					size > 0
					include_locked = no
				}
				is_core_of = ROOT
			}
			add_building_construction = {
				type = mill
				level = 1
				instant_build = no
			}
		}
	}
}

add_crop_weaving_random = {
	if = {
		limit = {
			has_country_flag = core_all_construction_flag
		}
		random_owned_controlled_state = {
			limit = {
				free_building_slots = {
					building = crop_weaving
					size > 0
					include_locked = no
				}
			}
			add_building_construction = {
				type = crop_weaving
				level = 1
				instant_build = no
			}
		}
	}
	else = {
		random_owned_controlled_state = {
			limit = {
				free_building_slots = {
					building = crop_weaving
					size > 0
					include_locked = no
				}
				is_core_of = ROOT
			}
			add_building_construction = {
				type = crop_weaving
				level = 1
				instant_build = no
			}
		}
	}
}

add_animal_weaving_random = {
	if = {
		limit = {
			has_country_flag = core_all_construction_flag
		}
		random_owned_controlled_state = {
			limit = {
				free_building_slots = {
					building = animal_weaving
					size > 0
					include_locked = no
				}
			}
			add_building_construction = {
				type = animal_weaving
				level = 1
				instant_build = no
			}
		}
	}
	else = {
		random_owned_controlled_state = {
			limit = {
				free_building_slots = {
					building = animal_weaving
					size > 0
					include_locked = no
				}
				is_core_of = ROOT
			}
			add_building_construction = {
				type = animal_weaving
				level = 1
				instant_build = no
			}
		}
	}
}

add_steelworks_random = {
	if = {
		limit = {
			has_country_flag = core_all_construction_flag
		}
		random_owned_controlled_state = {
			limit = {
				free_building_slots = {
					building = steelworks
					size > 0
					include_locked = no
				}
			}
			add_building_construction = {
				type = steelworks
				level = 1
				instant_build = no
			}
		}
	}
	else = {
		random_owned_controlled_state = {
			limit = {
				free_building_slots = {
					building = steelworks
					size > 0
					include_locked = no
				}
				is_core_of = ROOT
			}
			add_building_construction = {
				type = steelworks
				level = 1
				instant_build = no
			}
		}
	}
}

add_smithy_random = {
	if = {
		limit = {
			has_country_flag = core_all_construction_flag
		}
		random_owned_controlled_state = {
			limit = {
				free_building_slots = {
					building = arms_factory
					size > 0
					include_locked = no
				}
			}
			add_building_construction = {
				type = arms_factory
				level = 1
				instant_build = no
			}
		}
	}
	else = {
		random_owned_controlled_state = {
			limit = {
				free_building_slots = {
					building = arms_factory
					size > 0
					include_locked = no
				}
				is_core_of = ROOT
			}
			add_building_construction = {
				type = arms_factory
				level = 1
				instant_build = no
			}
		}
	}
}

add_factory_random = {
	if = {
		limit = {
			has_country_flag = core_all_construction_flag
		}
		random_owned_controlled_state = {
			limit = {
				free_building_slots = {
					building = factory
					size > 0
					include_locked = no
				}
			}
			add_building_construction = {
				type = factory
				level = 1
				instant_build = no
			}
		}
	}
	else = {
		random_owned_controlled_state = {
			limit = {
				free_building_slots = {
					building = factory
					size > 0
					include_locked = no
				}
				is_core_of = ROOT
			}
			add_building_construction = {
				type = factory
				level = 1
				instant_build = no
			}
		}
	}
}

add_harbour_random = {
	if = {
		limit = {
			has_country_flag = core_all_construction_flag
		}
		random_owned_controlled_state = {
			limit = {
				free_building_slots = {
					building = harbour
					size > 0
					include_locked = no
				}
				is_coastal = yes
			}
			add_building_construction = {
				type = harbour
				level = 1
				instant_build = no
			}
		}
	}
	else = {
		random_owned_controlled_state = {
			limit = {
				free_building_slots = {
					building = harbour
					size > 0
					include_locked = no
				}
				is_core_of = ROOT
				is_coastal = yes
			}
			add_building_construction = {
				type = harbour
				level = 1
				instant_build = no
			}
		}
	}
}

add_dockyard_random = {
	if = {
		limit = {
			has_country_flag = core_all_construction_flag
		}
		random_owned_controlled_state = {
			limit = {
				free_building_slots = {
					building = dockyard
					size > 0
					include_locked = no
				}
				is_coastal = yes
			}
			add_building_construction = {
				type = dockyard
				level = 1
				instant_build = no
			}
		}
	}
	else = {
		random_owned_controlled_state = {
			limit = {
				free_building_slots = {
					building = dockyard
					size > 0
					include_locked = no
				}
				is_core_of = ROOT
				is_coastal = yes
			}
			add_building_construction = {
				type = dockyard
				level = 1
				instant_build = no
			}
		}
	}
}

add_consumer_good_factory_random = {
	if = {
		limit = {
			has_country_flag = core_all_construction_flag
		}
		random_owned_controlled_state = {
			limit = {
				free_building_slots = {
					building = consumer_good_factory
					size > 0
					include_locked = no
				}
			}
			add_building_construction = {
				type = consumer_good_factory
				level = 1
				instant_build = no
			}
		}
	}
	else = {
		random_owned_controlled_state = {
			limit = {
				free_building_slots = {
					building = consumer_good_factory
					size > 0
					include_locked = no
				}
				is_core_of = ROOT
			}
			add_building_construction = {
				type = consumer_good_factory
				level = 1
				instant_build = no
			}
		}
	}
}

add_luxury_good_factory_random = {
	if = {
		limit = {
			has_country_flag = core_all_construction_flag
		}
		random_owned_controlled_state = {
			limit = {
				free_building_slots = {
					building = luxury_good_factory
					size > 0
					include_locked = no
				}
			}
			add_building_construction = {
				type = luxury_good_factory
				level = 1
				instant_build = no
			}
		}
	}
	else = {
		random_owned_controlled_state = {
			limit = {
				free_building_slots = {
					building = luxury_good_factory
					size > 0
					include_locked = no
				}
				is_core_of = ROOT
			}
			add_building_construction = {
				type = luxury_good_factory
				level = 1
				instant_build = no
			}
		}
	}
}

add_carpentry_random = {
	if = {
		limit = {
			has_country_flag = core_all_construction_flag
		}
		random_owned_controlled_state = {
			limit = {
				free_building_slots = {
					building = carpentry
					size > 0
					include_locked = no
				}
			}
			add_building_construction = {
				type = carpentry
				level = 1
				instant_build = no
			}
		}
	}
	else = {
		random_owned_controlled_state = {
			limit = {
				free_building_slots = {
					building = carpentry
					size > 0
					include_locked = no
				}
				is_core_of = ROOT
			}
			add_building_construction = {
				type = carpentry
				level = 1
				instant_build = no
			}
		}
	}
}

add_masonry_random = {
	if = {
		limit = {
			has_country_flag = core_all_construction_flag
		}
		random_owned_controlled_state = {
			limit = {
				free_building_slots = {
					building = masonry
					size > 0
					include_locked = no
				}
			}
			add_building_construction = {
				type = masonry
				level = 1
				instant_build = no
			}
		}
	}
	else = {
		random_owned_controlled_state = {
			limit = {
				free_building_slots = {
					building = masonry
					size > 0
					include_locked = no
				}
				is_core_of = ROOT
			}
			add_building_construction = {
				type = masonry
				level = 1
				instant_build = no
			}
		}
	}
}

add_steel_beam_factory_random = {
	if = {
		limit = {
			has_country_flag = core_all_construction_flag
		}
		random_owned_controlled_state = {
			limit = {
				free_building_slots = {
					building = steel_beam_factory
					size > 0
					include_locked = no
				}
			}
			add_building_construction = {
				type = steel_beam_factory
				level = 1
				instant_build = no
			}
		}
	}
	else = {
		random_owned_controlled_state = {
			limit = {
				free_building_slots = {
					building = steel_beam_factory
					size > 0
					include_locked = no
				}
				is_core_of = ROOT
			}
			add_building_construction = {
				type = steel_beam_factory
				level = 1
				instant_build = no
			}
		}
	}
}

###    ###  #   # ###    ###   #   #     
#  #  #   # ##  # #  #  #   #  ## ##      
###   ##### # # # #  #  #   #  # # #     
#  #  #   # #  ## #  #  #   #  #   #   
#   # #   # #   # ###    ###   #   #     
# #   #  ### #####  ###  #   # #####         
# ##  # #      #   #   # ##  #   #   
# # # #  ##    #   ##### # # #   #       
# #  ##    #   #   #   # #  ##   #   
# #   # ###    #   #   # #   #   #   
add_farm_random_instant = {
	
	random_controlled_state = {
		limit = {
			AND = {
				ROOT = { NOT = { has_country_flag = core_all_construction_flag } }
				is_core_of = ROOT
			}
			set_temp_variable = { farms = building_level@farm }
			add_to_temp_variable = { farms = farm_construction_que }
			check_variable = {
				field > farms
			}
		}

		add_building_construction = {
			type = farm
			level = 1
			instant_build = yes
		}
		save_event_target_as = building_in_this_state
	}

}

add_fishing_stand_random_instant = {

	random_controlled_state = {
		limit = {
			AND = {
				ROOT = { NOT = { has_country_flag = core_all_construction_flag } }
				is_core_of = ROOT
			}
			set_temp_variable = { fishing_stands = building_level@fishing_stand }
			add_to_temp_variable = { fishing_stands = fishing_stand_construction_que }
			check_variable = {
				water > fishing_stands
			}
		}

		add_building_construction = {
			type = fishing_stand
			level = 1
			instant_build = yes
		}
		save_event_target_as = building_in_this_state
	}

}

add_ranch_random_instant = {

	random_controlled_state = {
		limit = {
			AND = {
				ROOT = { NOT = { has_country_flag = core_all_construction_flag } }
				is_core_of = ROOT
			}
			set_temp_variable = { ranches = building_level@ranch }
			add_to_temp_variable = { ranches = ranch_construction_que }
			check_variable = {
				animal > ranches
			}
		}

		add_building_construction = {
			type = ranch
			level = 1
			instant_build = yes
		}
		save_event_target_as = building_in_this_state
	}
}

add_lumber_mill_random_instant = {

	random_controlled_state = {
		limit = {
			AND = {
				ROOT = { NOT = { has_country_flag = core_all_construction_flag } }
				is_core_of = ROOT
			}
			set_temp_variable = { lumber_mills = building_level@lumber_mill }
			add_to_temp_variable = { lumber_mills = lumber_mill_construction_que }
			check_variable = {
				forest > lumber_mills
			}
		}

		add_building_construction = {
			type = lumber_mill
			level = 1
			instant_build = yes
		}
		save_event_target_as = building_in_this_state
	}
}

add_quarry_random_instant = {

	random_controlled_state = {
		limit = {
			AND = {
				ROOT = { NOT = { has_country_flag = core_all_construction_flag } }
				is_core_of = ROOT
			}
			set_temp_variable = { quarries = building_level@quarry }
			add_to_temp_variable = { quarries = quarry_construction_que }
			check_variable = {
				stonefield > quarries
			}
		}

		add_building_construction = {
			type = quarry
			level = 1
			instant_build = yes
		}
		save_event_target_as = building_in_this_state
	}
}

add_mine_random_instant = {

	random_controlled_state = {
		limit = {
			AND = {
				ROOT = { NOT = { has_country_flag = core_all_construction_flag } }
				is_core_of = ROOT
			}
			set_temp_variable = { mines = building_level@mine }
			add_to_temp_variable = { mines = mine_construction_que }
			check_variable = {
				mountain > mines
			}
		}

		add_building_construction = {
			type = mine
			level = 1
			instant_build = yes
		}
		save_event_target_as = building_in_this_state
	}
}

add_mill_random_instant = {
	effect_tooltip = {
		add_building_construction = {
			type = mill
			level = 1
			instant_build = yes
		}
	}
	hidden_effect = {
		if = {
			limit = {
				has_country_flag = core_all_construction_flag
			}
			random_owned_controlled_state = {
				limit = {
					free_building_slots = {
						building = mill
						size > 0
						include_locked = no
					}
				}
				add_building_construction = {
					type = mill
					level = 1
					instant_build = yes
				}
				save_event_target_as = building_in_this_state
			}
		}
		else = {
			random_owned_controlled_state = {
				limit = {
					free_building_slots = {
						building = mill
						size > 0
						include_locked = no
					}
					is_core_of = ROOT
				}
				add_building_construction = {
					type = mill
					level = 1
					instant_build = yes
				}
				save_event_target_as = building_in_this_state
			}
		}
	}
}

add_crop_weaving_random_instant = {
	effect_tooltip = {
		add_building_construction = {
			type = crop_weaving
			level = 1
			instant_build = yes
		}
	}
	hidden_effect = {
		if = {
			limit = {
				has_country_flag = core_all_construction_flag
			}
			random_owned_controlled_state = {
				limit = {
					free_building_slots = {
						building = crop_weaving
						size > 0
						include_locked = no
					}
				}
				add_building_construction = {
					type = crop_weaving
					level = 1
					instant_build = yes
				}
				save_event_target_as = building_in_this_state
			}
		}
		else = {
			random_owned_controlled_state = {
				limit = {
					free_building_slots = {
						building = crop_weaving
						size > 0
						include_locked = no
					}
					is_core_of = ROOT
				}
				add_building_construction = {
					type = crop_weaving
					level = 1
					instant_build = yes
				}
				save_event_target_as = building_in_this_state
			}
		}
	}
}

add_animal_weaving_random_instant = {
	effect_tooltip = {
		add_building_construction = {
			type = animal_weaving
			level = 1
			instant_build = yes
		}
	}
	hidden_effect = {
		if = {
			limit = {
				has_country_flag = core_all_construction_flag
			}
			random_owned_controlled_state = {
				limit = {
					free_building_slots = {
						building = animal_weaving
						size > 0
						include_locked = no
					}
				}
				add_building_construction = {
					type = animal_weaving
					level = 1
					instant_build = yes
				}
				save_event_target_as = building_in_this_state
			}
		}
		else = {
			random_owned_controlled_state = {
				limit = {
					free_building_slots = {
						building = animal_weaving
						size > 0
						include_locked = no
					}
					is_core_of = ROOT
				}
				add_building_construction = {
					type = animal_weaving
					level = 1
					instant_build = yes
				}
				save_event_target_as = building_in_this_state
			}
		}
	}
}

add_steelworks_random_instant = {
	effect_tooltip = {
		add_building_construction = {
			type = steelworks
			level = 1
			instant_build = yes
		}
	}
	hidden_effect = {
		if = {
			limit = {
				has_country_flag = core_all_construction_flag
			}
			random_owned_controlled_state = {
				limit = {
					free_building_slots = {
						building = steelworks
						size > 0
						include_locked = no
					}
				}
				add_building_construction = {
					type = steelworks
					level = 1
					instant_build = yes
				}
				save_event_target_as = building_in_this_state
			}
		}
		else = {
			random_owned_controlled_state = {
				limit = {
					free_building_slots = {
						building = steelworks
						size > 0
						include_locked = no
					}
					is_core_of = ROOT
				}
				add_building_construction = {
					type = steelworks
					level = 1
					instant_build = yes
				}
				save_event_target_as = building_in_this_state
			}
		}
	}
}

add_smithy_random_instant = {
	effect_tooltip = {
		add_building_construction = {
			type = arms_factory
			level = 1
			instant_build = yes
		}
	}
	hidden_effect = {
		if = {
			limit = {
				has_country_flag = core_all_construction_flag
			}
			random_owned_controlled_state = {
				limit = {
					free_building_slots = {
						building = arms_factory
						size > 0
						include_locked = no
					}
				}
				add_building_construction = {
					type = arms_factory
					level = 1
					instant_build = yes
				}
				save_event_target_as = building_in_this_state
			}
		}
		else = {
			random_owned_controlled_state = {
				limit = {
					free_building_slots = {
						building = arms_factory
						size > 0
						include_locked = no
					}
					is_core_of = ROOT
				}
				add_building_construction = {
					type = arms_factory
					level = 1
					instant_build = yes
				}
				save_event_target_as = building_in_this_state
			}
		}
	}
}

add_factory_random_instant = {
	effect_tooltip = {
		add_building_construction = {
			type = factory
			level = 1
			instant_build = yes
		}
	}
	hidden_effect = {
		if = {
			limit = {
				has_country_flag = core_all_construction_flag
			}
			random_owned_controlled_state = {
				limit = {
					free_building_slots = {
						building = factory
						size > 0
						include_locked = no
					}
				}
				add_building_construction = {
					type = factory
					level = 1
					instant_build = yes
				}
				save_event_target_as = building_in_this_state
			}
		}
		else = {
			random_owned_controlled_state = {
				limit = {
					free_building_slots = {
						building = factory
						size > 0
						include_locked = no
					}
					is_core_of = ROOT
				}
				add_building_construction = {
					type = factory
					level = 1
					instant_build = yes
				}
				save_event_target_as = building_in_this_state
			}
		}
	}
}

add_harbour_random_instant = {
	effect_tooltip = {
		add_building_construction = {
			type = harbour
			level = 1
			instant_build = yes
		}
	}
	hidden_effect = {
		if = {
			limit = {
				has_country_flag = core_all_construction_flag
			}
			random_owned_controlled_state = {
				limit = {
					free_building_slots = {
						building = harbour
						size > 0
						include_locked = no
					}
					is_coastal = yes
				}
				add_building_construction = {
					type = harbour
					level = 1
					instant_build = yes
				}
				save_event_target_as = building_in_this_state
			}
		}
		else = {
			random_owned_controlled_state = {
				limit = {
					free_building_slots = {
						building = harbour
						size > 0
						include_locked = no
					}
					is_core_of = ROOT
					is_coastal = yes
				}
				add_building_construction = {
					type = harbour
					level = 1
					instant_build = yes
				}
				save_event_target_as = building_in_this_state
			}
		}
	}
}

add_dockyard_random_instant = {
	effect_tooltip = {
		add_building_construction = {
			type = dockyard
			level = 1
			instant_build = yes
		}
	}
	hidden_effect = {
		if = {
			limit = {
				has_country_flag = core_all_construction_flag
			}
			random_owned_controlled_state = {
				limit = {
					free_building_slots = {
						building = dockyard
						size > 0
						include_locked = no
					}
					is_coastal = yes
				}
				add_building_construction = {
					type = dockyard
					level = 1
					instant_build = yes
				}
				save_event_target_as = building_in_this_state
			}
		}
		else = {
			random_owned_controlled_state = {
				limit = {
					free_building_slots = {
						building = dockyard
						size > 0
						include_locked = no
					}
					is_core_of = ROOT
					is_coastal = yes
				}
				add_building_construction = {
					type = dockyard
					level = 1
					instant_build = yes
				}
				save_event_target_as = building_in_this_state
			}
		}
	}
}

add_consumer_good_factory_random_instant = {
	effect_tooltip = {
		add_building_construction = {
			type = consumer_good_factory
			level = 1
			instant_build = yes
		}
	}
	hidden_effect = {
		if = {
			limit = {
				has_country_flag = core_all_construction_flag
			}
			random_owned_controlled_state = {
				limit = {
					free_building_slots = {
						building = consumer_good_factory
						size > 0
						include_locked = no
					}
				}
				add_building_construction = {
					type = consumer_good_factory
					level = 1
					instant_build = yes
				}
				save_event_target_as = building_in_this_state
			}
		}
		else = {
			random_owned_controlled_state = {
				limit = {
					free_building_slots = {
						building = consumer_good_factory
						size > 0
						include_locked = no
					}
					is_core_of = ROOT
				}
				add_building_construction = {
					type = consumer_good_factory
					level = 1
					instant_build = yes
				}
				save_event_target_as = building_in_this_state
			}
		}
	}
}

add_luxury_good_factory_random_instant = {
	effect_tooltip = {
		add_building_construction = {
			type = luxury_good_factory
			level = 1
			instant_build = yes
		}
	}
	hidden_effect = {
		if = {
			limit = {
				has_country_flag = core_all_construction_flag
			}
			random_owned_controlled_state = {
				limit = {
					free_building_slots = {
						building = luxury_good_factory
						size > 0
						include_locked = no
					}
				}
				add_building_construction = {
					type = luxury_good_factory
					level = 1
					instant_build = yes
				}
				save_event_target_as = building_in_this_state
			}
		}
		else = {
			random_owned_controlled_state = {
				limit = {
					free_building_slots = {
						building = luxury_good_factory
						size > 0
						include_locked = no
					}
					is_core_of = ROOT
				}
				add_building_construction = {
					type = luxury_good_factory
					level = 1
					instant_build = yes
				}
				save_event_target_as = building_in_this_state
			}
		}
	}
}

add_carpentry_random_instant = {
	effect_tooltip = {
		add_building_construction = {
			type = carpentry
			level = 1
			instant_build = yes
		}
	}
	hidden_effect = {
		if = {
			limit = {
				has_country_flag = core_all_construction_flag
			}
			random_owned_controlled_state = {
				limit = {
					free_building_slots = {
						building = carpentry
						size > 0
						include_locked = no
					}
				}
				add_building_construction = {
					type = carpentry
					level = 1
					instant_build = yes
				}
				save_event_target_as = building_in_this_state
			}
		}
		else = {
			random_owned_controlled_state = {
				limit = {
					free_building_slots = {
						building = carpentry
						size > 0
						include_locked = no
					}
					is_core_of = ROOT
				}
				add_building_construction = {
					type = carpentry
					level = 1
					instant_build = yes
				}
				save_event_target_as = building_in_this_state
			}
		}
	}
}

add_masonry_random_instant = {
	effect_tooltip = {
		add_building_construction = {
			type = masonry
			level = 1
			instant_build = yes
		}
	}
	hidden_effect = {
		if = {
			limit = {
				has_country_flag = core_all_construction_flag
			}
			random_owned_controlled_state = {
				limit = {
					free_building_slots = {
						building = masonry
						size > 0
						include_locked = no
					}
				}
				add_building_construction = {
					type = masonry
					level = 1
					instant_build = yes
				}
				save_event_target_as = building_in_this_state
			}
		}
		else = {
			random_owned_controlled_state = {
				limit = {
					free_building_slots = {
						building = masonry
						size > 0
						include_locked = no
					}
					is_core_of = ROOT
				}
				add_building_construction = {
					type = masonry
					level = 1
					instant_build = yes
				}
				save_event_target_as = building_in_this_state
			}
		}
	}
}

add_steel_beam_factory_random_instant = {
	effect_tooltip = {
		add_building_construction = {
			type = steel_beam_factory
			level = 1
			instant_build = yes
		}
	}
	hidden_effect = {
		if = {
			limit = {
				has_country_flag = core_all_construction_flag
			}
			random_owned_controlled_state = {
				limit = {
					free_building_slots = {
						building = steel_beam_factory
						size > 0
						include_locked = no
					}
				}
				add_building_construction = {
					type = steel_beam_factory
					level = 1
					instant_build = yes
				}
				save_event_target_as = building_in_this_state
			}
		}
		else = {
			random_owned_controlled_state = {
				limit = {
					free_building_slots = {
						building = steel_beam_factory
						size > 0
						include_locked = no
					}
					is_core_of = ROOT
				}
				add_building_construction = {
					type = steel_beam_factory
					level = 1
					instant_build = yes
				}
				save_event_target_as = building_in_this_state
			}
		}
	}
}

farm_investment_cost = {
	subtract_from_variable = {
		peoples_investment_ic = 370
	}
}

ranch_investment_cost = {
	subtract_from_variable = {
		peoples_investment_ic = 400
	}
}

fishing_stand_investment_cost = {
	subtract_from_variable = {
		peoples_investment_ic = 350
	}
}

lumber_mill_investment_cost = {
	subtract_from_variable = {
		peoples_investment_ic = 520
	}
}

quarry_investment_cost = {
	subtract_from_variable = {
		peoples_investment_ic = 580
	}
}

mine_investment_cost = {
	subtract_from_variable = {
		peoples_investment_ic = 900
	}
}

crop_weaving_investment_cost = {
	subtract_from_variable = {
		peoples_investment_ic = 410
	}
}

animal_weaving_investment_cost = {
	subtract_from_variable = {
		peoples_investment_ic = 410
	}
}

mill_investment_cost = {
	subtract_from_variable = {
		peoples_investment_ic = 460
	}
}

smelting_investment_cost = {
	subtract_from_variable = {
		peoples_investment_ic = 1800
	}
}

smithy_investment_cost = {
	subtract_from_variable = {
		peoples_investment_ic = 2200
	}
}

factory_investment_cost = {
	subtract_from_variable = {
		peoples_investment_ic = 6000
	}
}

harbour_investment_cost = {
	subtract_from_variable = {
		peoples_investment_ic = 1400
	}
}

dockyard_investment_cost = {
	subtract_from_variable = {
		peoples_investment_ic = 2000
	}
}

shop_investment_cost = {
	subtract_from_variable = {
		peoples_investment_ic = 800
	}
}

luxury_store_investment_cost = {
	subtract_from_variable = {
		peoples_investment_ic = 1200
	}
}

carpentry_investment_cost = {
	subtract_from_variable = {
		peoples_investment_ic = 1400
	}
}

masonry_investment_cost = {
	subtract_from_variable = {
		peoples_investment_ic = 1400
	}
}

steel_beam_factory_investment_cost = {
	subtract_from_variable = {
		peoples_investment_ic = 2400
	}
}

peoples_initiative_construction_effect = {
	random_list = {
		ai_priority_steel = {
			modifier = {
				factor = 0
				NOT = {
					has_tech = steelworks_1
				}
			}
			modifier = {
				factor = 0
				check_variable = {
					peoples_investment_ic < 1800
				}
			}
			smelting_investment_cost = yes
			country_event = {
				id = centralisation.14
				days = 1
				random_days = 30
			}
		}
		ai_priority_animal_products = {
			modifier = {
				factor = 0
				NOT = {
					has_tech = ranch_1
				}
			}
			modifier = {
				factor = 0
				check_variable = {
					peoples_investment_ic < 400
				}
			}
			modifier = {
				factor = 0
				NOT = {
					any_owned_state = {
						check_variable = {
							animal > 0.1
						}
					}
				}
			}
			ranch_investment_cost = yes
			country_event = {
				id = centralisation.5
				days = 1
				random_days = 30
			}
		}
		ai_priority_wood = {
			modifier = {
				factor = 0
				NOT = {
					any_owned_state = {
						check_variable = {
							forest > 0.1
						}
					}
				}
			}
			modifier = {
				factor = 0
				NOT = {
					has_tech = lumber_1
				}
			}
			modifier = {
				factor = 0
				check_variable = {
					peoples_investment_ic < 520
				}
			}
			lumber_mill_investment_cost = yes
			country_event = {
				id = centralisation.7
				days = 1
				random_days = 30
			}
		}
		ai_priority_iron = {
			modifier = {
				factor = 0
				NOT = {
					has_tech = mine_1
				}
			}
			modifier = {
				factor = 0
				check_variable = {
					peoples_investment_ic < 900
				}
			}
			modifier = {
				factor = 0
				NOT = {
					any_owned_state = {
						check_variable = {
							mountain > 0.1
						}
					}
				}
			}
			mine_investment_cost = yes
			country_event = {
				id = centralisation.15
				days = 1
				random_days = 30
			}
		}
		ai_priority_textile = {
			modifier = {
				factor = 0
				OR = {
					NOT = {
						has_tech = animal_weaving_1
					}
					NOT = {
						has_tech = crop_weaving_1
					}
				}
			}
			modifier = {
				factor = 0
				check_variable = {
					peoples_investment_ic < 410
				}
			}
			animal_weaving_investment_cost = yes
			country_event = {
				id = centralisation.9
				days = 1
				random_days = 30
			}
		}
		ai_priority_minerals = {
			modifier = {
				factor = 0
				NOT = {
					has_tech = quarry_1
				}
			}
			modifier = {
				factor = 0
				check_variable = {
					peoples_investment_ic < 580
				}
			}
			modifier = {
				factor = 0
				NOT = {
					any_owned_state = {
						check_variable = {
							stonefield > 0.1
						}
					}
				}
			}
			quarry_investment_cost = yes
			country_event = {
				id = centralisation.8
				days = 1
				random_days = 30
			}
		}
		ai_priority_grain = {
			modifier = {
				factor = 0
				NOT = {
					has_tech = farm_1
				}
			}
			modifier = {
				factor = 0
				check_variable = {
					peoples_investment_ic < 370
				}
			}
			modifier = {
				factor = 0
				NOT = {
					any_owned_state = {
						check_variable = {
							field > 0.1
						}
					}
				}
			}
			farm_investment_cost = yes
			country_event = {
				id = centralisation.4
				days = 1
				random_days = 30
			}
		}
		ai_priority_fossile_fuels = {
			modifier = {
				factor = 0
				NOT = {
					has_tech = mine_1
				}
			}
			modifier = {
				factor = 0
				check_variable = {
					peoples_investment_ic < 900
				}
			}
			modifier = {
				factor = 0
				NOT = {
					any_owned_state = {
						check_variable = {
							mountain > 0.1
						}
					}
				}
			}
			mine_investment_cost = yes
			country_event = {
				id = centralisation.15
				days = 1
				random_days = 30
			}
		}
		ai_priority_food = {
			random_list = {
				1 = {
					modifier = {
						factor = 0
						NOT = {
							has_tech = mill_1
						}
					}
					modifier = {
						factor = 0
						check_variable = {
							peoples_investment_ic < 460
						}
					}
					modifier = {
						factor = 0
						check_variable = {
							ai_priority_grain > ai_priority_food
						}
					}
					mill_investment_cost = yes
					country_event = {
						id = centralisation.6
						days = 1
						random_days = 30
					}
				}
				1 = {
					modifier = {
						factor = 0
						NOT = {
							has_tech = farm_1
						}
					}
					modifier = {
						factor = 0
						check_variable = {
							peoples_investment_ic < 370
						}
					}
					modifier = {
						factor = 0
						NOT = {
							any_owned_state = {
								check_variable = {
									field > 0.1
								}
							}
						}
					}
					farm_investment_cost = yes
					country_event = {
						id = centralisation.4
						days = 1
						random_days = 30
					}
				}
				1 = {
					modifier = {
						factor = 0
						NOT = {
							has_tech = fishing_stand_1
						}
					}
					modifier = {
						factor = 0
						check_variable = {
							peoples_investment_ic < 350
						}
					}
					modifier = {
						factor = 0
						NOT = {
							any_owned_state = {
								check_variable = {
									water > 0.1
								}
							}
						}
					}
					fishing_stand_investment_cost = yes
					country_event = {
						id = centralisation.18
						days = 1
						random_days = 30
					}
				}
			}
		}
		ai_priority_consumer_goods = {
			modifier = {
				factor = 0
				NOT = {
					has_tech = shops_1
				}
			}
			modifier = {
				factor = 0
				check_variable = {
					peoples_investment_ic < 800
				}
			}
			shop_investment_cost = yes
			country_event = {
				id = centralisation.10
				days = 1
				random_days = 30
			}
		}
		ai_priority_luxury_goods = {
			modifier = {
				factor = 0
				NOT = {
					has_tech = shops_1
				}
			}
			modifier = {
				factor = 0
				check_variable = {
					peoples_investment_ic < 1200
				}
			}
			luxury_store_investment_cost = yes
			country_event = {
				id = centralisation.11
				days = 1
				random_days = 30
			}
		}
		ai_priority_planks = {
			modifier = {
				factor = 0
				NOT = {
					has_tech = carpentry_1
				}
			}
			modifier = {
				factor = 0
				check_variable = {
					peoples_investment_ic < 1400
				}
			}
			carpentry_investment_cost = yes
			country_event = {
				id = centralisation.2
				days = 1
				random_days = 30
			}
		}
		ai_priority_bricks = {
			modifier = {
				factor = 0
				NOT = {
					has_tech = masonry_1
				}
			}
			modifier = {
				factor = 0
				check_variable = {
					peoples_investment_ic < 1400
				}
			}
			masonry_investment_cost = yes
			country_event = {
				id = centralisation.3
				days = 1
				random_days = 30
			}
		}
		ai_priority_steel_beams = {
			modifier = {
				factor = 0
				NOT = {
					has_tech = steel_beam_factory_1
				}
			}
			modifier = {
				factor = 0
				check_variable = {
					peoples_investment_ic < 2400
				}
			}
			steel_beam_factory_investment_cost = yes
			country_event = {
				id = centralisation.16
				days = 1
				random_days = 30
			}
		}
	}
}
